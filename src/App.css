// LocalStorage'dan verileri Ã§ek veya boÅŸ dizi oluÅŸtur
let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
let myChart;

// Sayfa yÃ¼klendiÄŸinde listeyi getir
document.addEventListener('DOMContentLoaded', renderTasks);

function updateDashboard() {
    const completedCount = tasks.filter(t => t.completed).length;
    const pendingCount = tasks.length - completedCount;
    
    // SayaÃ§larÄ± gÃ¼ncelle
    document.getElementById('totalTasks').innerText = tasks.length;
    document.getElementById('compText').innerText = completedCount;
    document.getElementById('pendText').innerText = pendingCount;
    
    // Durum mesajÄ±
    const msg = document.getElementById('statusMsg');
    if(tasks.length === 0) msg.innerText = "Liste boÅŸ, yeni gÃ¶rev ekle!";
    else if(pendingCount === 0) msg.innerText = "Harika! TÃ¼m gÃ¶revler bitti. ðŸŽ‰";
    else msg.innerText = "Devam et, baÅŸarabilirsin! ðŸ’ª";

    // Grafik (Chart.js) GÃ¼ncelleme
    const ctx = document.getElementById('taskChart').getContext('2d');
    if (myChart) myChart.destroy(); // Eski grafiÄŸi sil (Ã§akÄ±ÅŸmamasÄ± iÃ§in)
    
    myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Tamamlanan', 'Bekleyen'],
            datasets: [{
                data: [completedCount, pendingCount],
                backgroundColor: ['#4f46e5', '#e2e8f0'],
                hoverOffset: 4,
                borderWidth: 0
            }]
        },
        options: {
            cutout: '75%',
            plugins: { legend: { display: false } }
        }
    });
}

function renderTasks() {
    const taskList = document.getElementById('taskList');
    taskList.innerHTML = '';

    tasks.forEach((task, index) => {
        const tr = document.createElement('tr');
        tr.className = `border-b border-gray-50 transition ${task.completed ? 'task-done' : ''}`;
        
        tr.innerHTML = `
            <td class="p-5">
                <input type="checkbox" ${task.completed ? 'checked' : ''} 
                    onchange="toggleTask(${index})" 
                    class="w-6 h-6 rounded-lg accent-indigo-600 cursor-pointer">
            </td>
            <td class="p-5 font-medium ${task.completed ? 'line-through text-gray-400' : 'text-gray-700'}">
                ${task.text}
            </td>
            <td class="p-5 text-gray-500 text-sm">
                ${task.date ? task.date : 'Belirtilmedi'}
            </td>
            <td class="p-5 text-right">
                <button onclick="deleteTask(${index})" class="text-red-400 hover:text-red-600 font-bold px-3 py-1 rounded-lg hover:bg-red-50 transition">
                    Sil
                </button>
            </td>
        `;
        taskList.appendChild(tr);
    });

    localStorage.setItem('tasks', JSON.stringify(tasks));
    updateDashboard();
}

function addTask() {
    const taskInput = document.getElementById('taskInput');
    const dateInput = document.getElementById('dateInput');
    
    if (taskInput.value.trim() === '') {
        alert("LÃ¼tfen bir gÃ¶rev yazÄ±n!");
        return;
    }

    tasks.push({
        text: taskInput.value,
        date: dateInput.value,
        completed: false
    });

    taskInput.value = '';
    dateInput.value = '';
    renderTasks();
}

function toggleTask(index) {
    tasks[index].completed = !tasks[index].completed;
    renderTasks();
}

function deleteTask(index) {
    if(confirm("Bu gÃ¶revi silmek istediÄŸine emin misin?")) {
        tasks.splice(index, 1);
        renderTasks();
    }
}
